"use strict";
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __read = (this && this.__read) || function (o, n) {
    var m = typeof Symbol === "function" && o[Symbol.iterator];
    if (!m) return o;
    var i = m.call(o), r, ar = [], e;
    try {
        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);
    }
    catch (error) { e = { error: error }; }
    finally {
        try {
            if (r && !r.done && (m = i["return"])) m.call(i);
        }
        finally { if (e) throw e.error; }
    }
    return ar;
};
var __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {
    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {
        if (ar || !(i in from)) {
            if (!ar) ar = Array.prototype.slice.call(from, 0, i);
            ar[i] = from[i];
        }
    }
    return to.concat(ar || Array.prototype.slice.call(from));
};
var __values = (this && this.__values) || function(o) {
    var s = typeof Symbol === "function" && Symbol.iterator, m = s && o[s], i = 0;
    if (m) return m.call(o);
    if (o && typeof o.length === "number") return {
        next: function () {
            if (o && i >= o.length) o = void 0;
            return { value: o && o[i++], done: !o };
        }
    };
    throw new TypeError(s ? "Object is not iterable." : "Symbol.iterator is not defined.");
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.getAppLogOption = exports.parseFeatureFlags = exports.parseStaticServerPort = exports.parseMainPort = exports.parsePortRange = exports.parseArgs = exports.handleLoggerSetup = void 0;
var commander_1 = require("commander");
var node_os_1 = __importDefault(require("node:os"));
var node_path_1 = __importDefault(require("node:path"));
var uuid_1 = require("uuid");
var caller_type_1 = require("../../../../shared/enums/caller-type");
var error_codes_1 = require("../../../../shared/errors/error-codes");
var error_source_1 = require("../../../../shared/errors/error-source");
var status_code_1 = require("../../../../shared/errors/status-code");
var log_level_1 = require("../../../../shared/logger/log-level");
var eps_logger_1 = require("../../../logging/eps-logger");
var EPS_INSTANCE_ID = (0, uuid_1.v4)();
var epsTempDirRoot = node_path_1.default.join(node_os_1.default.tmpdir(), 'tableau-eps-temp');
var epsTempDir = node_path_1.default.join(epsTempDirRoot, EPS_INSTANCE_ID);
// TODO: the default folder should not have Tableau dependency...
// verify there's nothing replying on this, and point to cwd/log
var DEFAULT_LOG_DIR = node_path_1.default.join(node_os_1.default.homedir(), 'Documents', 'My Tableau Repository', 'Logs');
var DEFAULT_LOG_LEVEL = log_level_1.LogLevel.DEBUG;
var DEFAULT_STATIC_SERVER_UI_DIR = node_path_1.default.join(epsTempDir, 'static-server', 'app');
var DEFAULT_STATIC_SERVER_HANDLERS_DIR = node_path_1.default.join(epsTempDir, 'static-server', 'handlers');
var DEFAULT_LANGUAGE = 'en_US';
var DEFAULT_LOCALE = 'en_US';
/**
 * A command line value for log level option to disable a log writer.
 * Note: it should be only used in the command line layer.
 */
var LOG_OFF_LEVEL = 'off';
var logLevelChoices = __spreadArray(__spreadArray([], __read(log_level_1.logLevelValues), false), [LOG_OFF_LEVEL], false);
function handleLoggerSetup(args) {
    var program = new commander_1.Command();
    // throw for error cases, so that it can log errors and fall back
    addLoggerOptions(program).allowUnknownOption().exitOverride();
    try {
        program.parse(args);
    }
    catch (error) {
        // if logger configs are incorrect, init logger with fallback settings
        eps_logger_1.Logger.init(EPS_INSTANCE_ID, {
            filename: eps_logger_1.EPS_LOG_FILE_NAME,
            fileLogDirPath: DEFAULT_LOG_DIR,
            fileLogLevel: log_level_1.LogLevel.INFO,
            sourceName: 'EPS',
            consoleLogLevel: log_level_1.LogLevel.WARNING,
        });
        eps_logger_1.Logger.error("Invalid logging options: ".concat(error, "."));
        eps_logger_1.Logger.warn('Initializing logger with fallback settings.');
        return;
    }
    var _a = program.opts(), logDir = _a.logDir, logLevel = _a.logLevel, consoleLogLevel = _a.consoleLogLevel;
    var appLogOption = getAppLogOption({ logDir: logDir, logLevel: logLevel, consoleLogLevel: consoleLogLevel });
    var loggerConfig = (0, eps_logger_1.createLoggerConfig)('EPS', appLogOption);
    eps_logger_1.Logger.init(EPS_INSTANCE_ID, loggerConfig);
}
exports.handleLoggerSetup = handleLoggerSetup;
function addLoggerOptions(program) {
    return program
        .option('--log-dir <log_dir>', 'Log Directory', DEFAULT_LOG_DIR)
        .addOption(new commander_1.Option('--log-level <log_level>', "Log level for file-based logs. Choices: ".concat(logLevelChoices))
        .argParser(parseLogLevel)
        .default(DEFAULT_LOG_LEVEL))
        .addOption(new commander_1.Option('--console-log-level <log_level>', "Log level for console logs. Choices: ".concat(logLevelChoices))
        .argParser(parseLogLevel)
        .default(LOG_OFF_LEVEL));
}
function parseLogLevel(value) {
    var lowerCaseValue = value.toLowerCase();
    if (!logLevelChoices.includes(lowerCaseValue)) {
        throw new commander_1.InvalidArgumentError("Allowed choices are: ".concat(logLevelChoices));
    }
    return lowerCaseValue;
}
function parseArgs(args) {
    var program = new commander_1.Command();
    addLoggerOptions(program)
        .requiredOption('--caller-pid <caller_pid>', 'Caller Process Id', parsePid)
        .requiredOption('--caller-id <caller_id>', 'Caller Id')
        .requiredOption('--port-file <port_file>', 'Port file path')
        .addOption(new commander_1.Option('--caller-type <caller_type>', 'Valid values: desktop, prep, vizqlserver, etc.')
        .choices(Object.values(caller_type_1.CallerType))
        .default(caller_type_1.CallerType.desktop))
        .option('--feature-flags <feature_flags>', 'EPS feature flags as defined in monolith')
        .option('--port-range <port_range>', 'Port range for all EPS services. Format: start-end', parsePortRange, [9089, 9999])
        .option('--static-server-ui-dir <log_dir>', 'Connector app root directory', DEFAULT_STATIC_SERVER_UI_DIR)
        .option('--static-server-handlers-dir <log_dir>', 'Connector handlers root directory', DEFAULT_STATIC_SERVER_HANDLERS_DIR)
        .option('--static-server-port <port>', 'Static Server port to use, for vizqlserver only')
        .option('--main-port <port>', 'Main API port to use, for vizqlserver only')
        .option('--grpc-server-port <port>', 'grpc Server port to use', parsePort)
        .option('--language <language>', 'Runtime user choice for language', DEFAULT_LANGUAGE)
        .option('--locale <locale>', 'Runtime user choice for locale', DEFAULT_LOCALE)
        .option('--eps-temp-dir-path <dir_path>', 'Root for temporary file storage', epsTempDirRoot)
        .addHelpCommand()
        .allowUnknownOption()
        .configureOutput({
        writeOut: function (str) { return eps_logger_1.Logger.info("".concat(str)); },
        writeErr: function (str) {
            return eps_logger_1.Logger.logEPSError(status_code_1.StatusCode.InvalidArgument, error_source_1.ErrorSources.Content, error_codes_1.ErrorCodes.ORP420NN, "Error with command line options. ".concat(str));
        },
    });
    program.parse(args);
    var options = program.opts();
    eps_logger_1.Logger.debug("Command arguments: ".concat(JSON.stringify(options, undefined, 2)));
    return __assign(__assign({}, options), { 
        // addtional parsing for certain properties
        mainPort: parseMainPort(options), staticServerPort: parseStaticServerPort(options), featureFlags: parseFeatureFlags(options.featureFlags), epsInstanceId: EPS_INSTANCE_ID });
}
exports.parseArgs = parseArgs;
function parsePortRange(portRange) {
    var parts = portRange.split('-');
    if (parts.length !== 2) {
        throw new commander_1.InvalidArgumentError("Port range must be formatted in 'start-end'");
    }
    var start = parseInt(parts[0], 10);
    var end = parseInt(parts[1], 10);
    if (!isValidPort(start) || !isValidPort(end)) {
        throw new commander_1.InvalidArgumentError("Invalid port number in the port range: ".concat(portRange));
    }
    if (end - start < 5) {
        throw new commander_1.InvalidArgumentError('EPS requires at least 5 ports');
    }
    return [start, end];
}
exports.parsePortRange = parsePortRange;
function parsePort(portString) {
    var port = parseInt(portString, 10);
    if (!isValidPort(port)) {
        throw new commander_1.InvalidArgumentError("Invalid port number: ".concat(portString));
    }
    return port;
}
function isValidPort(port) {
    return Number.isInteger(port) && port > 0 && port <= 65535;
}
function parsePid(pidString) {
    var pid = parseInt(pidString, 10);
    if (isNaN(pid) || pid < 0) {
        throw new commander_1.InvalidArgumentError("Invalid pid number: ".concat(pidString));
    }
    return pid;
}
function parseMainPort(options) {
    var callerType = options.callerType, mainPort = options.mainPort;
    if (mainPort === undefined) {
        if (callerType === caller_type_1.CallerType.vizQLServer || callerType === caller_type_1.CallerType.dcf) {
            throw new Error("--main-port must be provided when --caller-type is ".concat(callerType, "."));
        }
        return;
    }
    if (callerType !== caller_type_1.CallerType.vizQLServer && callerType !== caller_type_1.CallerType.dcf) {
        throw new Error("--main-port can be only used when --caller-type is ".concat(caller_type_1.CallerType.vizQLServer, " or ").concat(caller_type_1.CallerType.dcf, ". The current caller type is '").concat(callerType, "'."));
    }
    return parsePort(mainPort);
}
exports.parseMainPort = parseMainPort;
function parseStaticServerPort(options) {
    var callerType = options.callerType, staticServerPort = options.staticServerPort;
    if (staticServerPort === undefined) {
        if (callerType === caller_type_1.CallerType.vizQLServer) {
            throw new Error("--static-server-port must be provided when --caller-type is ".concat(callerType, "."));
        }
        return;
    }
    if (callerType !== caller_type_1.CallerType.vizQLServer) {
        throw new Error("--static-server-port can be only used when --caller-type is ".concat(caller_type_1.CallerType.vizQLServer, ". The current caller type is '").concat(callerType, "'."));
    }
    return parsePort(staticServerPort);
}
exports.parseStaticServerPort = parseStaticServerPort;
/**
 * The configuration for feature flags from monolith.
 * This config does not include all feature flags passed from monolith,
 * but only the flags that EPS needs to handle.
 */
var FEATURE_FLAGS_CONFIG = {
    EPSSupportgRPC: {
        falseValue: 'off',
        defaultValue: true,
    },
};
function parseFeatureFlags(input) {
    var e_1, _a;
    var flagsString = input !== null && input !== void 0 ? input : '';
    var args = flagsString
        .split(',')
        .filter(Boolean)
        .map(function (arg) {
        var _a = __read(arg.split(':'), 2), key = _a[0], value = _a[1];
        return [key.trim(), value === null || value === void 0 ? void 0 : value.trim()];
    });
    var flags = Object.fromEntries(args);
    var result = {};
    try {
        for (var _b = __values(Object.entries(FEATURE_FLAGS_CONFIG)), _c = _b.next(); !_c.done; _c = _b.next()) {
            var _d = __read(_c.value, 2), key = _d[0], config = _d[1];
            var flagName = key;
            var defaultValue = config.defaultValue, falseValue = config.falseValue;
            var value = flags[flagName];
            if (value === falseValue) {
                result[flagName] = false;
            }
            else {
                result[flagName] = defaultValue;
            }
        }
    }
    catch (e_1_1) { e_1 = { error: e_1_1 }; }
    finally {
        try {
            if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
        }
        finally { if (e_1) throw e_1.error; }
    }
    return result;
}
exports.parseFeatureFlags = parseFeatureFlags;
/**
 * Get app log options from command line values
 */
function getAppLogOption(options) {
    var logLevel = options.logLevel, consoleLogLevel = options.consoleLogLevel, logDir = options.logDir;
    if (logLevel === LOG_OFF_LEVEL) {
        return {
            // if file-based log has been explicitly disabled, force to enable console log
            consoleLogLevel: consoleLogLevel === LOG_OFF_LEVEL ? log_level_1.LogLevel.INFO : consoleLogLevel,
            logDir: undefined,
            logLevel: undefined,
        };
    }
    var logOption = {
        logDir: logDir,
        logLevel: logLevel,
        consoleLogLevel: consoleLogLevel === LOG_OFF_LEVEL ? undefined : consoleLogLevel,
    };
    return logOption;
}
exports.getAppLogOption = getAppLogOption;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tbWFuZC1saW5lLXBhcnNlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9lcHMvbWFpbi9jb3JlL2FwcC11dGlscy9jb21tYW5kLWxpbmUtcGFyc2VyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsdUNBQStFO0FBQy9FLG9EQUF3QjtBQUN4Qix3REFBNEI7QUFDNUIsNkJBQW1DO0FBRW5DLG9FQUFpRTtBQUNqRSxxRUFBa0U7QUFDbEUsdUVBQXFFO0FBQ3JFLHFFQUFrRTtBQUNsRSxpRUFBOEU7QUFDOUUsMERBQTJGO0FBSTNGLElBQU0sZUFBZSxHQUFHLElBQUEsU0FBTSxHQUFFLENBQUE7QUFDaEMsSUFBTSxjQUFjLEdBQUcsbUJBQUksQ0FBQyxJQUFJLENBQUMsaUJBQUUsQ0FBQyxNQUFNLEVBQUUsRUFBRSxrQkFBa0IsQ0FBQyxDQUFBO0FBQ2pFLElBQU0sVUFBVSxHQUFHLG1CQUFJLENBQUMsSUFBSSxDQUFDLGNBQWMsRUFBRSxlQUFlLENBQUMsQ0FBQTtBQUU3RCxpRUFBaUU7QUFDakUsZ0VBQWdFO0FBQ2hFLElBQU0sZUFBZSxHQUFHLG1CQUFJLENBQUMsSUFBSSxDQUFDLGlCQUFFLENBQUMsT0FBTyxFQUFFLEVBQUUsV0FBVyxFQUFFLHVCQUF1QixFQUFFLE1BQU0sQ0FBQyxDQUFBO0FBQzdGLElBQU0saUJBQWlCLEdBQUcsb0JBQVEsQ0FBQyxLQUFLLENBQUE7QUFDeEMsSUFBTSw0QkFBNEIsR0FBRyxtQkFBSSxDQUFDLElBQUksQ0FBQyxVQUFVLEVBQUUsZUFBZSxFQUFFLEtBQUssQ0FBQyxDQUFBO0FBQ2xGLElBQU0sa0NBQWtDLEdBQUcsbUJBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxFQUFFLGVBQWUsRUFBRSxVQUFVLENBQUMsQ0FBQTtBQUM3RixJQUFNLGdCQUFnQixHQUFHLE9BQU8s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