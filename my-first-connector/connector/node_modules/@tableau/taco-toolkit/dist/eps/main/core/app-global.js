"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var eps_logger_1 = require("../../logging/eps-logger");
var port_manager_1 = require("../../modules/port-manager");
var temp_data_manager_1 = require("../../modules/temp-data-manager");
var connection_manager_1 = require("../components/connection-manager");
var process_manager_1 = require("../components/process-manager");
var taco_initializer_1 = require("../components/taco-initializer");
var AppGlobal = /** @class */ (function () {
    function AppGlobal(config) {
        var callerType = config.callerType, epsInstanceId = config.epsInstanceId, epsTempDirPath = config.epsTempDirPath, portRange = config.portRange, reservedPorts = config.reservedPorts, connectorAppDir = config.connectorAppDir, connectorHandlerDir = config.connectorHandlerDir, i18nConfig = config.i18nConfig;
        var tempDataManager = new temp_data_manager_1.TempDataManager(epsInstanceId, epsTempDirPath);
        this._processManager = new process_manager_1.EPSProcessManager(tempDataManager);
        this._portManager = new port_manager_1.PortManager(portRange[0], portRange[1], reservedPorts);
        this._connectionManager = new connection_manager_1.ConnectionManager(this._processManager, tempDataManager);
        this._tacoInitializer = new taco_initializer_1.TacoInitializer(this._connectionManager, {
            callerType: callerType,
            appDir: connectorAppDir,
            handlersDir: connectorHandlerDir,
            i18n: i18nConfig,
        });
    }
    AppGlobal.init = function (config) {
        if (this.instance) {
            eps_logger_1.Logger.warn('AppGlobal has already been initialized. Skipping...');
            return;
        }
        this.instance = new AppGlobal(config);
        // in monolith context, this is Tableau app process
        this.instance._processManager.addPID(config.parentPid, 'eps-parent', process_manager_1.ProcessType.parent);
        this.instance._processManager.start();
    };
    Object.defineProperty(AppGlobal, "processManager", {
        get: function () {
            assertInit(this.instance);
            return this.instance._processManager;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(AppGlobal, "portManager", {
        get: function () {
            assertInit(this.instance);
            return this.instance._portManager;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(AppGlobal, "connectionManager", {
        get: function () {
            assertInit(this.instance);
            return this.instance._connectionManager;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(AppGlobal, "tacoInitializer", {
        get: function () {
            assertInit(this.instance);
            return this.instance._tacoInitializer;
        },
        enumerable: false,
        configurable: true
    });
    return AppGlobal;
}());
function assertInit(instance) {
    if (!instance) {
        throw new Error('AppGlobal must be initialized.');
    }
}
exports.default = AppGlobal;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBwLWdsb2JhbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9lcHMvbWFpbi9jb3JlL2FwcC1nbG9iYWwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFDQSx1REFBaUQ7QUFDakQsMkRBQXdEO0FBQ3hELHFFQUFpRTtBQUNqRSx1RUFBb0U7QUFDcEUsaUVBQThFO0FBQzlFLG1FQUFnRTtBQWVoRTtJQVFFLG1CQUFvQixNQUFrQjtRQUVsQyxJQUFBLFVBQVUsR0FRUixNQUFNLFdBUkUsRUFDVixhQUFhLEdBT1gsTUFBTSxjQVBLLEVBQ2IsY0FBYyxHQU1aLE1BQU0sZUFOTSxFQUNkLFNBQVMsR0FLUCxNQUFNLFVBTEMsRUFDVCxhQUFhLEdBSVgsTUFBTSxjQUpLLEVBQ2IsZUFBZSxHQUdiLE1BQU0sZ0JBSE8sRUFDZixtQkFBbUIsR0FFakIsTUFBTSxvQkFGVyxFQUNuQixVQUFVLEdBQ1IsTUFBTSxXQURFLENBQ0Y7UUFFVixJQUFNLGVBQWUsR0FBRyxJQUFJLG1DQUFlLENBQUMsYUFBYSxFQUFFLGNBQWMsQ0FBQyxDQUFBO1FBQzFFLElBQUksQ0FBQyxlQUFlLEdBQUcsSUFBSSxtQ0FBaUIsQ0FBQyxlQUFlLENBQUMsQ0FBQTtRQUM3RCxJQUFJLENBQUMsWUFBWSxHQUFHLElBQUksMEJBQVcsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLEVBQUUsU0FBUyxDQUFDLENBQUMsQ0FBQyxFQUFFLGFBQWEsQ0FBQyxDQUFBO1FBQzlFLElBQUksQ0FBQyxrQkFBa0IsR0FBRyxJQUFJLHNDQUFpQixDQUFDLElBQUksQ0FBQyxlQUFlLEVBQUUsZUFBZSxDQUFDLENBQUE7UUFDdEYsSUFBSSxDQUFDLGdCQUFnQixHQUFHLElBQUksa0NBQWUsQ0FBQyxJQUFJLENBQUMsa0JBQWtCLEVBQUU7WUFDbkUsVUFBVSxZQUFBO1lBQ1YsTUFBTSxFQUFFLGVBQWU7WUFDdkIsV0FBVyxFQUFFLG1CQUFtQjtZQUNoQyxJQUFJLEVBQUUsVUFBVTtTQUNqQixDQUFDLENBQUE7SUFDSixDQUFDO0lBRU0sY0FBSSxHQUFYLFVBQVksTUFBa0I7UUFDNUIsSUFBSSxJQUFJLENBQUMsUUFBUSxFQUFFO1lBQ2pCLG1CQUFNLENBQUMsSUFBSSxDQUFDLHFEQUFxRCxDQUFDLENBQUE7WUFDbEUsT0FBTTtTQUNQO1FBRUQsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQTtRQUVyQyxtREFBbUQ7UUFDbkQsSUFBSSxDQUFDLFFBQVEsQ0FBQyxlQUFlLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxTQUFTLEVBQUUsWUFBWSxFQUFFLDZCQUFXLENBQUMsTUFBTSxDQUFDLENBQUE7UUFDeEYsSUFBSSxDQUFDLFFBQVEsQ0FBQyxlQUFlLENBQUMsS0FBSyxFQUFFLENBQUE7SUFDdkMsQ0FBQztJQUVELHNCQUFrQiwyQkFBYzthQUFoQztZQUNFLFVBQVUsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUE7WUFDekIsT0FBTyxJQUFJLENBQUMsUUFBUSxDQUFDLGVBQWUsQ0FBQTtRQUN0QyxDQUFDOzs7T0FBQTtJQUVELHNCQUFrQix3QkFBVzthQUE3QjtZQUNFLFVBQVUsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUE7WUFDekIsT0FBTyxJQUFJLENBQUMsUUFBUSxDQUFDLFlBQVksQ0FBQTtRQUNuQyxDQUFDOzs7T0FBQTtJQUVELHNCQUFrQiw4QkFBaUI7YUFBbkM7WUFDRSxVQUFVLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFBO1lBQ3pCLE9BQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQyxrQkFBa0IsQ0FBQTtRQUN6QyxDQUFDOzs7T0FBQTtJQUVELHNCQUFrQiw0QkFBZTthQUFqQztZQUNFLFVBQVUsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUE7WUFDekIsT0FBTyxJQUFJLENBQUMsUUFBUSxDQUFDLGdCQUFnQixDQUFBO1FBQ3ZDLENBQUM7OztPQUFBO0lBQ0gsZ0JBQUM7QUFBRCxDQUFDLEFBaEVELElBZ0VDO0FBRUQsU0FBUyxVQUFVLENBQUMsUUFBK0I7SUFDakQsSUFBSSxDQUFDLFFBQVEsRUFBRTtRQUNiLE1BQU0sSUFBSSxLQUFLLENBQUMsZ0NBQWdDLENBQUMsQ0FBQTtLQUNsRDtBQUNILENBQUM7QUFFRCxrQkFBZSxTQUFTLENBQUEifQ==