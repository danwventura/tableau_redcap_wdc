"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.requestLogReplacer = void 0;
var url_utils_1 = require("../../utils/url-utils");
function requestLogReplacer(request) {
    // root path endpoint is used for redirects from connectors,
    // which may contain user infos and credentials.
    if (request.path === '/') {
        var _a = request.query, url = _a.url, headers = _a.headers;
        return {
            requestPath: request.path,
            url: parseURLParam(url),
            headers: parseHeadersParam(headers),
        };
    }
}
exports.requestLogReplacer = requestLogReplacer;
function parseURLParam(urlStr) {
    if (urlStr === undefined) {
        return {};
    }
    if (typeof urlStr === 'string') {
        try {
            return (0, url_utils_1.parseUrlAndQueryParams)(urlStr);
        }
        catch (e) {
            // no-op, return message below
        }
    }
    return 'Invalid URL string';
}
function parseHeadersParam(headerStr) {
    if (headerStr === undefined) {
        return [];
    }
    if (typeof headerStr === 'string') {
        try {
            return Object.keys(JSON.parse(headerStr));
        }
        catch (e) {
            // no-op, return message below
        }
    }
    return 'Invalid header string';
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXBzLWFwaS11dGlscy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9lcHMvbWFpbi9hcGkvZXBzLWFwaS11dGlscy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFDQSxtREFBOEQ7QUFFOUQsU0FBZ0Isa0JBQWtCLENBQUMsT0FBZ0I7SUFDakQsNERBQTREO0lBQzVELGdEQUFnRDtJQUVoRCxJQUFJLE9BQU8sQ0FBQyxJQUFJLEtBQUssR0FBRyxFQUFFO1FBQ2xCLElBQUEsS0FBbUIsT0FBTyxDQUFDLEtBQUssRUFBOUIsR0FBRyxTQUFBLEVBQUUsT0FBTyxhQUFrQixDQUFBO1FBQ3RDLE9BQU87WUFDTCxXQUFXLEVBQUUsT0FBTyxDQUFDLElBQUk7WUFDekIsR0FBRyxFQUFFLGFBQWEsQ0FBQyxHQUFHLENBQUM7WUFDdkIsT0FBTyxFQUFFLGlCQUFpQixDQUFDLE9BQU8sQ0FBQztTQUNwQyxDQUFBO0tBQ0Y7QUFDSCxDQUFDO0FBWkQsZ0RBWUM7QUFFRCxTQUFTLGFBQWEsQ0FBQyxNQUFlO0lBQ3BDLElBQUksTUFBTSxLQUFLLFNBQVMsRUFBRTtRQUN4QixPQUFPLEVBQUUsQ0FBQTtLQUNWO0lBRUQsSUFBSSxPQUFPLE1BQU0sS0FBSyxRQUFRLEVBQUU7UUFDOUIsSUFBSTtZQUNGLE9BQU8sSUFBQSxrQ0FBc0IsRUFBQyxNQUFNLENBQUMsQ0FBQTtTQUN0QztRQUFDLE9BQU8sQ0FBQyxFQUFFO1lBQ1YsOEJBQThCO1NBQy9CO0tBQ0Y7SUFFRCxPQUFPLG9CQUFvQixDQUFBO0FBQzdCLENBQUM7QUFFRCxTQUFTLGlCQUFpQixDQUFDLFNBQWtCO0lBQzNDLElBQUksU0FBUyxLQUFLLFNBQVMsRUFBRTtRQUMzQixPQUFPLEVBQUUsQ0FBQTtLQUNWO0lBRUQsSUFBSSxPQUFPLFNBQVMsS0FBSyxRQUFRLEVBQUU7UUFDakMsSUFBSTtZQUNGLE9BQU8sTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUE7U0FDMUM7UUFBQyxPQUFPLENBQUMsRUFBRTtZQUNWLDhCQUE4QjtTQUMvQjtLQUNGO0lBQ0QsT0FBTyx1QkFBdUIsQ0FBQTtBQUNoQyxDQUFDIn0=