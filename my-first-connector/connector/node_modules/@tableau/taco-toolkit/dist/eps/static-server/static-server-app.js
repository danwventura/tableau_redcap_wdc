"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
var eps_logger_1 = require("../logging/eps-logger");
var eps_process_types_1 = require("../types/eps-process-types");
var static_server_1 = __importDefault(require("./static-server"));
var static_server_app_config_1 = require("./static-server-app-config");
var static_server_message_1 = require("./static-server-message");
var StaticServerApp = /** @class */ (function () {
    function StaticServerApp(staticServerId, connectorAppDir) {
        this.staticServer = new static_server_1.default(staticServerId, connectorAppDir);
    }
    StaticServerApp.prototype.start = function (port) {
        return this.staticServer.start(port);
    };
    StaticServerApp.prototype.close = function () {
        return this.staticServer.close();
    };
    return StaticServerApp;
}());
if (require.main === module) {
    process.title = eps_process_types_1.EPSProcessName.EPSStaticServer;
    var _a = (0, static_server_app_config_1.getStaticServerAppConfig)(), epsInstanceId = _a.epsInstanceId, logOption = _a.logOption, staticServerPort = _a.staticServerPort, staticServerId = _a.staticServerId, connectorAppDir = _a.connectorAppDir;
    var loggerConfig = (0, eps_logger_1.createLoggerConfig)('static-server', logOption);
    eps_logger_1.Logger.init(epsInstanceId, loggerConfig);
    eps_logger_1.Logger.debug("Initiating ".concat(StaticServerApp.name));
    var staticServerApp_1 = new StaticServerApp(staticServerId, connectorAppDir);
    process.on('SIGTERM', function () {
        eps_logger_1.Logger.info('SIGTERM signal received: closing Static Server');
        staticServerApp_1.close();
    });
    staticServerApp_1
        .start(staticServerPort)
        .then(function () {
        return (0, static_server_message_1.sendStaticServerMessage)({
            status: 'success',
        });
    })
        .catch(function (error) {
        eps_logger_1.Logger.error(error);
        (0, static_server_message_1.sendStaticServerMessage)({
            status: 'error',
            error: error,
        });
    });
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RhdGljLXNlcnZlci1hcHAuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvZXBzL3N0YXRpYy1zZXJ2ZXIvc3RhdGljLXNlcnZlci1hcHAudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxvREFBa0U7QUFDbEUsZ0VBQTJEO0FBQzNELGtFQUEwQztBQUMxQyx1RUFBcUU7QUFDckUsaUVBQWlFO0FBRWpFO0lBR0UseUJBQVksY0FBc0IsRUFBRSxlQUF1QjtRQUN6RCxJQUFJLENBQUMsWUFBWSxHQUFHLElBQUksdUJBQVksQ0FBQyxjQUFjLEVBQUUsZUFBZSxDQUFDLENBQUE7SUFDdkUsQ0FBQztJQUVELCtCQUFLLEdBQUwsVUFBTSxJQUFZO1FBQ2hCLE9BQU8sSUFBSSxDQUFDLFlBQVksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUE7SUFDdEMsQ0FBQztJQUVELCtCQUFLLEdBQUw7UUFDRSxPQUFPLElBQUksQ0FBQyxZQUFZLENBQUMsS0FBSyxFQUFFLENBQUE7SUFDbEMsQ0FBQztJQUNILHNCQUFDO0FBQUQsQ0FBQyxBQWRELElBY0M7QUFFRCxJQUFJLE9BQU8sQ0FBQyxJQUFJLEtBQUssTUFBTSxFQUFFO0lBQzNCLE9BQU8sQ0FBQyxLQUFLLEdBQUcsa0NBQWMsQ0FBQyxlQUFlLENBQUE7SUFFeEMsSUFBQSxLQUFrRixJQUFBLG1EQUF3QixHQUFFLEVBQTFHLGFBQWEsbUJBQUEsRUFBRSxTQUFTLGVBQUEsRUFBRSxnQkFBZ0Isc0JBQUEsRUFBRSxjQUFjLG9CQUFBLEVBQUUsZUFBZSxxQkFBK0IsQ0FBQTtJQUVsSCxJQUFNLFlBQVksR0FBRyxJQUFBLCtCQUFrQixFQUFDLGVBQWUsRUFBRSxTQUFTLENBQUMsQ0FBQTtJQUNuRSxtQkFBTSxDQUFDLElBQUksQ0FBQyxhQUFhLEVBQUUsWUFBWSxDQUFDLENBQUE7SUFFeEMsbUJBQU0sQ0FBQyxLQUFLLENBQUMscUJBQWMsZUFBZSxDQUFDLElBQUksQ0FBRSxDQUFDLENBQUE7SUFDbEQsSUFBTSxpQkFBZSxHQUFHLElBQUksZUFBZSxDQUFDLGNBQWMsRUFBRSxlQUFlLENBQUMsQ0FBQTtJQUU1RSxPQUFPLENBQUMsRUFBRSxDQUFDLFNBQVMsRUFBRTtRQUNwQixtQkFBTSxDQUFDLElBQUksQ0FBQyxnREFBZ0QsQ0FBQyxDQUFBO1FBQzdELGlCQUFlLENBQUMsS0FBSyxFQUFFLENBQUE7SUFDekIsQ0FBQyxDQUFDLENBQUE7SUFFRixpQkFBZTtTQUNaLEtBQUssQ0FBQyxnQkFBZ0IsQ0FBQztTQUN2QixJQUFJLENBQUM7UUFDSixPQUFPLElBQUEsK0NBQXVCLEVBQUM7WUFDN0IsTUFBTSxFQUFFLFNBQVM7U0FDbEIsQ0FBQyxDQUFBO0lBQ0osQ0FBQyxDQUFDO1NBQ0QsS0FBSyxDQUFDLFVBQUMsS0FBSztRQUNYLG1CQUFNLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFBO1FBQ25CLElBQUEsK0NBQXVCLEVBQUM7WUFDdEIsTUFBTSxFQUFFLE9BQU87WUFDZixLQUFLLEVBQUUsS0FBSztTQUNiLENBQUMsQ0FBQTtJQUNKLENBQUMsQ0FBQyxDQUFBO0NBQ0wifQ==